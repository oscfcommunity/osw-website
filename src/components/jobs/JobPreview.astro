---
import { getCollection } from 'astro:content';
import Container from '../layout/Container.astro';
import JobCard from './JobCard.astro';

const {
  enabled = true,
  title = 'Latest Job Opportunities',
  subtitle = 'Discover exciting career opportunities in the open source community',
  showCount = 3,
  showFeaturedOnly = false,
  ctaButton = {
    text: 'View All Jobs',
    link: '/jobs',
    style: 'primary',
    size: 'lg',
  },
  sectionBackground = 'bg-base-100',
  useFluidContainer = false,
} = Astro.props;

if (!enabled) {
  return null;
}

const allJobs = await getCollection(
  'jobs',
  ({ data }) =>
    data.status === 'ACTIVE' && (!showFeaturedOnly || data.featured)
);

const jobs = allJobs
  .sort((a, b) => b.data.datePosted.getTime() - a.data.datePosted.getTime())
  .slice(0, showCount);

if (jobs.length === 0) {
  return null;
}

const responsiveBtnSize =
  ctaButton.size === 'lg'
    ? 'btn-md md:btn-lg'
    : ctaButton.size === 'md'
      ? 'btn-sm md:btn-md'
      : 'btn-sm';
---

<section
  class:list={['py-16', sectionBackground]}
  aria-labelledby="jobs-heading"
>
  <Container fluid={useFluidContainer}>
    <div class="text-center mb-8 md:mb-12">
      <h2
        id="jobs-heading"
        class="text-3xl md:text-4xl font-bold text-base-content mb-3"
      >
        {title}
      </h2>
      {
        subtitle && (
          <p class="text-base md:text-lg text-base-content/70 max-w-2xl mx-auto">
            {subtitle}
          </p>
        )
      }
    </div>

    <div class="flex flex-col gap-4 md:gap-5 mb-8 md:mb-12">
      {jobs.map(job => <JobCard job={job} />)}
    </div>

    <div class="text-center">
      <a
        href={ctaButton.link}
        class={`btn btn-${ctaButton.style} ${responsiveBtnSize} gap-2 rounded-md`}
        aria-label="View all available job openings"
      >
        {ctaButton.text}
      </a>
    </div>
  </Container>
</section>
