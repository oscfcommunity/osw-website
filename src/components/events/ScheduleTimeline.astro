---
import ScheduleItem from './ScheduleItem.astro';

interface ScheduleEntry {
  datetime: Date;
  title: string;
  speaker?: string;
  type:
    | 'REGISTRATION'
    | 'ACTIVITY'
    | 'OPENING'
    | 'KEYNOTE'
    | 'TALK'
    | 'LUNCH'
    | 'CLOSING_KEYNOTE'
    | 'GOODIES_DISTRIBUTION';
  venue?: string;
  startDatetime: Date;
  endDatetime: Date;
  presentationLink?: string;
}

interface Props {
  schedule: ScheduleEntry[];
  isCompleted?: boolean;
}

const { schedule, isCompleted = false } = Astro.props;

// Sort schedule by start time
const sortedSchedule = [...schedule].sort(
  (a, b) => a.startDatetime.getTime() - b.startDatetime.getTime()
);
---

{
  schedule && schedule.length > 0 && (
    <section id="schedule" class="py-16 md:py-24 bg-base-100">
      <div class="container mx-auto px-4 max-w-5xl">
        {/* Section Header */}
        <div class="text-center mb-12">
          <h2 class="text-3xl md:text-4xl font-bold mb-4">Event Schedule</h2>
          <p class="text-base-content/70 max-w-2xl mx-auto">
            {isCompleted
              ? "Here's how the event unfolded throughout the day."
              : 'Plan your day with our detailed schedule of sessions and activities.'}
          </p>
          <div class="mt-4 text-sm text-base-content/60">
            <span class="inline-flex items-center gap-1">
              <svg
                class="w-4 h-4"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"
                />
              </svg>
              All times in IST (Indian Standard Time)
            </span>
          </div>
        </div>

        {/* Timeline */}
        <div class="space-y-4">
          {sortedSchedule.map(item => (
            <ScheduleItem
              title={item.title}
              speaker={item.speaker}
              type={item.type}
              venue={item.venue}
              startDatetime={item.startDatetime}
              endDatetime={item.endDatetime}
              presentationLink={item.presentationLink}
              isCompleted={isCompleted}
            />
          ))}
        </div>

        {/* Download Schedule CTA */}
        {!isCompleted && (
          <div class="mt-12 text-center">
            <div class="alert alert-info inline-flex max-w-md">
              <svg
                xmlns="http://www.w3.org/2000/svg"
                fill="none"
                viewBox="0 0 24 24"
                class="stroke-current shrink-0 w-6 h-6"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"
                />
              </svg>
              <span>
                Schedule is subject to minor changes. Check back for updates!
              </span>
            </div>
          </div>
        )}
      </div>
    </section>
  )
}
