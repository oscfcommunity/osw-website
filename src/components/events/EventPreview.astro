---
import { getCollection } from 'astro:content';
import Container from '../layout/Container.astro';
import EventCard from './EventCard.astro';

const {
  enabled = true,
  title = 'Upcoming Events',
  subtitle = 'Join us at our upcoming workshops, hackathons, and community meetups',
  showCount = 3,
  showFeaturedOnly = false,
  ctaButton = {
    text: 'View All Events',
    link: '/events',
    style: 'accent',
    size: 'lg',
  },
  sectionBackground = 'bg-base-200',
  useFluidContainer = false,
} = Astro.props;

if (!enabled) {
  return null;
}

const allEvents = await getCollection('events', ({ data }) => 
  (!showFeaturedOnly || data.featured)
);

const events = allEvents
  .sort((a, b) => new Date(a.data.date).getTime() - new Date(b.data.date).getTime())
  .slice(0, showCount);

if (events.length === 0) {
  return null;
}

const responsiveBtnSize = ctaButton.size === 'lg' 
  ? 'btn-md md:btn-lg' 
  : ctaButton.size === 'md'
  ? 'btn-sm md:btn-md'
  : 'btn-sm';
---

<section class:list={["py-16", sectionBackground]} aria-labelledby="events-heading">
  <Container fluid={useFluidContainer}>
    
    <div class="text-center mb-8 md:mb-12">
      <h2 id="events-heading" class="text-3xl md:text-4xl font-bold text-base-content mb-3">
        {title}
      </h2>
      {subtitle && (
        <p class="text-base md:text-lg text-base-content/70 max-w-2xl mx-auto">
          {subtitle}
        </p>
      )}
    </div>

    <div class="flex flex-col gap-4 md:gap-5 mb-8 md:mb-12">
      {events.map((event) => (
        <EventCard event={event} />
      ))}
    </div>

    <div class="text-center">
      <a 
        href={ctaButton.link}
        class={`btn btn-${ctaButton.style} ${responsiveBtnSize} gap-2 rounded-md`}
        aria-label="View all upcoming events"
      >
        {ctaButton.text}
      </a>
    </div>

  </Container>
</section>
